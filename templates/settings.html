<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCuBA Score Settings</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: #f9fafb; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1, h2 { color: #1f2937; }
        textarea { width: 100%; height: 300px; font-family: monospace; padding: 10px; border: 1px solid #d1d5db; border-radius: 4px; }
        button { background-color: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background-color: #1d4ed8; }
        a { color: #2563eb; text-decoration: none; margin-bottom: 20px; display: inline-block; }
        .success { color: green; margin-bottom: 10px; }
        .error { color: red; margin-bottom: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    </style>
</head>
<body>
    <a href="/">‚Üê Back to Dashboard</a>
    <h1>Configuration Settings</h1>
    
    {% if request.args.get('saved') %}
    <div class="success">Settings saved successfully!</div>
    {% endif %}
    {% if error %}
    <div class="error">Error saving settings: {{ error }}</div>
    {% endif %}

    <form method="POST">
        <div class="card">
            <h2>Service Weight Profile</h2>
            <p>Select which service weight profile to use (GWS, M365, etc.)</p>
            <select name="profile" onchange="switchProfile()" style="padding: 10px; font-size: 16px; border: 1px solid #d1d5db; border-radius: 4px;">
                {% for profile in available_profiles %}
                <option value="{{ profile }}" {% if profile == current_profile %}selected{% endif %}>{{ profile }}</option>
                {% endfor %}
            </select>
            <div id="profileStatus" style="margin-top: 10px; color: #666;"></div>
        </div>
        <div class="grid">
            <div class="card">
                <h2>Rule Weights (weights.yaml)</h2>
                <p>Define risk weights (1-5) for specific rules or prefixes.</p>
                <textarea name="weights_yaml">{{ weights }}</textarea>
            </div>
            
            <div class="card">
                <h2>Service Weights (service_weights.yaml)</h2>
                <p>Define the contribution of each service to the overall score.</p>
                <textarea name="service_weights_yaml">{{ service_weights }}</textarea>
            </div>
        </div>
        <button type="submit">Save Configurations</button>
    </form>

    <script>
        async function switchProfile() {
            const profileSelect = document.querySelector('select[name="profile"]');
            const serviceWeightsTextarea = document.querySelector('textarea[name="service_weights_yaml"]');
            const status = document.getElementById('profileStatus');
            const profile = profileSelect.value;

            status.textContent = 'Loading profile...';

            try {
                const response = await fetch(`/api/profiles/${profile}`);

                if (!response.ok) throw new Error('Failed to load profile');

                const data = await response.json();
                serviceWeightsTextarea.value = data.service_weights;
                status.textContent = 'Profile loaded successfully!';

                setTimeout(() => {
                    status.textContent = '';
                }, 2000);

            } catch (err) {
                status.textContent = 'Error: ' + err.message;
                status.style.color = 'red';
                console.error(err);
            }
        }
    </script>
</body>
</html>
